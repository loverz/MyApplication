# linux 用户与用户组管理

### linux /etc/password 内容

这个配置文件存储的是所有用户的主要信息

```shell
vi /etc/password
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
...
```

这里有用户为系统用户。不能用来登录，只是执行某些系统命令需要用到的系统用户身份。

| 名称      | 用户                                                         |
| --------- | ------------------------------------------------------------ |
| root      | 用户名称                                                     |
| x         | 密码标志，真正密码存放在etc/shadow 影子文件中，只有root用户可以读取。x代表这个用户是有密码的 |
| 0         | UID，linux识别用户是通过此字段，并不是通过名称 0：root 1-499：系统用户 500-65535：普通用户 |
| 0         | GID：组id，用户初始组标志号。这里只能看到初始组              |
| root      | 用户说明，类似mark                                           |
| /root     | 家目录，用户登录之后，能过访问操作权限的目录。超级用户是/root 普通用户，例如lxz 的加目录为 /home/lxz 目录 |
| /bin/bash | 登录之后的shell。linux的标准shell就是 /bin/bash              |

用户组分为初始组、附加组。一个用户只有一个初始组（手动创建用户的时候，例如 lxz，就会创建一个lxz的初始组），可以给他添加多个附加组，可以获得附加组对应的权限。

### etc/shadow 

存放用户密码的影子文件。包括：密码、最后修改时间、密码有效期、到期前警告天数、过期宽限天数、失效时间等

### etc/group

存放用户组文件。包括：组名、组密码标志、ID、组内用户

### etc/gshadow

组密码影子文件

### useradd 命令

用来添加用户

```shell
useradd [选项] 用户名
```



- -u UID: 手工指定用户的 UID，注意手工添加的用户的 UID 不要小于 500；
- -d 家目录：手工指定用户的家目录。家目录必须写绝对路径，而且如果需要手工指定家目录，则一定要注意权限；
- -c 用户说明：手工指定用户说明。还记得 /etc/passwd 文件的第五个字段吗？这里就是指定该字段内容的；
- -g 组名：手工指定用户的初始组。一般以和用户名相同的组作为用户的初始组，在创建用户时会默认建立初始组。如果不想使用默认初始组，则可以用 -g 手工指定。不建议手工修改；
- -G 组名：指定用户的附加组。我们把用户加入其他组，一般都使用附加组；
- -s shell：手工指定用户的登录 [Shell](http://c.biancheng.net/shell/)。默认是 /bin/bash；
- -e 曰期：指定用户的失效曰期，格式为"YYYY-MM-DD"。也就是/etc/shadow文件的第八个字段；
- -o：允许创建的用户的 UID 相同。例如，执行"useradd -u 0 -o usertest"命令建立用户 usertest，它的 UID 和 root 用户的 UID 相同，都是 0；
- -m：建立用户时强制建立用户的家目录。在建立系统用户时，该选项是默认的；

### password 命令

修改用户密码命令

```shell
password [选项] 用户
password # 直接修改当前用户密码
```

* -u 解锁
* -l 锁定

### usermod 

修改用户命令，包括家目录，组名，组别等

### chage 命令

修改密码状态，可以修改密码影子文件的第三道第八个字段。可以实现让用户一登录就修改密码的需求。

```shell
chage -d 0 lxz
# 将lxz用户修改日期为0，用户登录就会触发修改密码
```



### su 命令

切换用户身份命令

**切换用户时 "-" 代表连带环境变量一起切换，不能省略，否则用户身份切换不完全。**

### groupadd 命令

新增用户组

### gpassword命令

将用户添加到用户组或者删除

* -a 添加到用户组

* -d  从用户组删除

* ```shell
  gpassword [选项] 用户组
  ```


